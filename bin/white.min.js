var White={selector:"img",brightness:33,contrast:50,black_threshold:40,white_threshold:255,images:[],origin:window.location.origin,proxy:["http://crossorigin.me/","http://cors.io/?u="],proxy_index:0,loadLeft:0,canvas:document.createElement("canvas"),run:function(t){if(this.proxy_index=0,this.loadLeft=0,this.selector=this.selector||t,this.factor=259*(this.contrast+255)/(255*(259-this.contrast)),0==this.loadLeft){this.initImages();for(var e in this.images)this.applyToImage(this.images[e],!1)}},restore:function(t){var e=document.querySelectorAll(t);for(var i in e)this.restoreImage(e[i])},initImages:function(){this.images=[];var t=document.querySelectorAll(this.selector);for(var e in t)if(void 0!=t[e].style&&"IMG"==t[e].tagName){this.images.push([t[e],t[e].dataset.src||t[e].src,[[t[e].width],[t[e].height]],t[e].style.visibility]);var i=this.images[this.images.length-1];i[0].style.visibility="hidden"}this.loadLeft=this.images.length},applyToImage:function(t,e){var i=this,r=new Image;r.onload=function(){var e=t[0].naturalWidth||t[0].width,a=t[0].naturalHeight||t[0].height,s=i.canvas;s.width=e,s.height=a;var h=i.filterImage(r,e,a,s),o=s.getContext("2d");o.putImageData(h,0,0);var n=s.toDataURL();void 0==t[0].dataset.src&&(t[0].dataset.src=t[0].src),t[0].src=n,t[0].style.visibility=t[3],i.loadLeft-=1},r.onerror=function(r,a,s){e===!0&&i.proxy_index===i.proxy.length-1?(i.loadLeft-=1,i.proxy_index=0,t[0].src=t[1]):e===!0&&i.proxy_index<i.proxy.length-1?(i.proxy_index+=1,i.applyToImage(t,!0)):i.applyToImage(t,!0)};var a;a=e?this.proxy[this.proxy_index]+t[1]:t[1],0!=a.indexOf(this.origin)&&(r.crossOrigin="Anonymous"),r.src=a},restoreImage:function(t){void 0!=t.dataset.src&&"IMG"==t.tagName&&(t.src=t.dataset.src)},getCanvas:function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i},filterImage:function(t,e,i,r){return this.filter(this.getPixels(t,e,i,r))},getPixels:function(t,e,i,r){var a=r.getContext("2d");return a.fillStyle="#FFF",a.fillRect(0,0,r.width,r.height),a.globalCompositeOperation="luminosity",a.drawImage(t,0,0,r.width,r.height),a.getImageData(0,0,r.width,r.height)},filter:function(t){for(var e,i,r,a=t.data.length,s=0;s<a;s+=4)e=s,i=s+1,r=s+2,t.data[e]+=this.brightness,t.data[i]+=this.brightness,t.data[r]+=this.brightness,t.data[e]=this.factor*(t.data[s]-128)+128,t.data[i]=this.factor*(t.data[s+1]-128)+128,t.data[r]=this.factor*(t.data[s+2]-128)+128,t.data[e]<this.black_threshold&&(t.data[e]=this.black_threshold),t.data[i]<this.black_threshold&&(t.data[i]=this.black_threshold),t.data[r]<this.black_threshold&&(t.data[r]=this.black_threshold),t.data[e]>this.white_threshold&&(t.data[e]=this.white_threshold),t.data[i]>this.white_threshold&&(t.data[i]=this.white_threshold),t.data[r]>this.white_threshold&&(t.data[r]=this.white_threshold);return t}},QueryString=function(){for(var t={},e=document.currentScript.getAttribute("src").split("?")[1],i=e.split("&"),r=0;r<i.length;r++){var a=i[r].split("=");if("undefined"==typeof t[a[0]])t[a[0]]=decodeURIComponent(a[1]);else if("string"==typeof t[a[0]]){var s=[t[a[0]],decodeURIComponent(a[1])];t[a[0]]=s}else t[a[0]].push(decodeURIComponent(a[1]))}return t}();QueryString.proxy&&(White.proxy=QueryString.proxy),QueryString.selector&&(White.selector=QueryString.selector),QueryString.brightness&&(White.brightness=parseInt(QueryString.brightness)),QueryString.contrast&&(White.contrast=parseInt(QueryString.contrast)),QueryString.black_threshold&&(White.black_threshold=parseInt(QueryString.black_threshold)),QueryString.white_threshold&&(White.white_threshold=parseInt(QueryString.white_threshold)),QueryString.selector&&(White.selector=QueryString.selector),"true"===QueryString.run&&White.run();
