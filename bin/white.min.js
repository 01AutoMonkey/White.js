var White={selector:"img",brightness:33,contrast:50,black_threshold:40,white_threshold:255,images:[],image_info:[],proxy:["http://cors-anywhere.herokuapp.com/","http://crossorigin.me/","http://cors.io/?u="],origin:window.location.origin,init:!1,run:function(t){this.selector=t||this.selector,this.factor=259*(this.contrast+255)/(255*(259-this.contrast)),this.initImages();for(var e in this.images)this.applyFilter(e)},initImages:function(){var t=document.querySelectorAll(this.selector);for(var e in t)t[e]instanceof HTMLImageElement&&this.images.indexOf(t[e])==-1&&(this.images.push(t[e]),this.image_info.push({src:t[e].src,proxy:-1,canvas:document.createElement("canvas"),size:{x:null,y:null},pixels:null,vimg:null}));this.init=!0},applyFilter:function(t){var e=this,i=this.images[t],r=this.image_info[t];r.vimg=r.vimg||new Image,r.vimg.onload=function(){r.size={x:this.naturalWidth||this.width,y:this.naturalHeight||this.height},e.getPixels(r),e.filter(r);var t=r.canvas.getContext("2d");t.putImageData(r.pixels,0,0);var a=r.canvas.toDataURL();void 0==i.dataset.src&&(i.dataset.src=r.src),i.src=a},r.vimg.onerror=function(){r.proxy<e.proxy.length-1?(r.proxy+=1,e.applyFilter(t)):(i.src=r.src,r.proxy=-1)};var a;a=r.proxy>-1?this.proxy[e.image_info[t].proxy]+r.src:r.src,0!=a.indexOf(this.origin)&&(r.vimg.crossOrigin="Anonymous"),r.vimg.src=a},getPixels:function(t){var e=t.canvas;e.width=t.size.x,e.height=t.size.y;var i=e.getContext("2d");i.fillStyle="#FFF",i.fillRect(0,0,e.width,e.height),i.globalCompositeOperation="luminosity",i.drawImage(t.vimg,0,0,e.width,e.height),t.pixels=i.getImageData(0,0,e.width,e.height)},filter:function(t){for(var e,i,r,a=t.pixels,s=a.data.length,n=0;n<s;n+=4)e=n,i=n+1,r=n+2,a.data[e]+=this.brightness,a.data[i]+=this.brightness,a.data[r]+=this.brightness,a.data[e]=this.factor*(a.data[e]-128)+128,a.data[i]=this.factor*(a.data[i]-128)+128,a.data[r]=this.factor*(a.data[r]-128)+128,a.data[e]<this.black_threshold&&(a.data[e]=this.black_threshold),a.data[i]<this.black_threshold&&(a.data[i]=this.black_threshold),a.data[r]<this.black_threshold&&(a.data[r]=this.black_threshold),a.data[e]>this.white_threshold&&(a.data[e]=this.white_threshold),a.data[i]>this.white_threshold&&(a.data[i]=this.white_threshold),a.data[r]>this.white_threshold&&(a.data[r]=this.white_threshold)},restore:function(){for(var t in this.images)this.images[t].src=this.image_info[t].src}},QueryString=function(){for(var t={},e=document.currentScript.getAttribute("src").split("?")[1],i=e.split("&"),r=0;r<i.length;r++){var a=i[r].split("=");if("undefined"==typeof t[a[0]])t[a[0]]=decodeURIComponent(a[1]);else if("string"==typeof t[a[0]]){var s=[t[a[0]],decodeURIComponent(a[1])];t[a[0]]=s}else t[a[0]].push(decodeURIComponent(a[1]))}return t}();!function(t,e){"use strict";function i(){if(!s){s=!0;for(var t=0;t<a.length;t++)a[t].fn.call(window,a[t].ctx);a=[]}}function r(){"complete"===document.readyState&&i()}t=t||"docReady",e=e||window;var a=[],s=!1,n=!1;e[t]=function(t,e){return s?void setTimeout(function(){t(e)},1):(a.push({fn:t,ctx:e}),void("complete"===document.readyState||!document.attachEvent&&"interactive"===document.readyState?setTimeout(i,1):n||(document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):(document.attachEvent("onreadystatechange",r),window.attachEvent("onload",i)),n=!0)))}}("docReady",window),QueryString.proxy&&(White.proxy=QueryString.proxy),QueryString.selector&&(White.selector=QueryString.selector),QueryString.brightness&&(White.brightness=parseInt(QueryString.brightness)),QueryString.contrast&&(White.contrast=parseInt(QueryString.contrast)),QueryString.black_threshold&&(White.black_threshold=parseInt(QueryString.black_threshold)),QueryString.white_threshold&&(White.white_threshold=parseInt(QueryString.white_threshold)),QueryString.selector&&(White.selector=QueryString.selector),"true"===QueryString.run&&docReady(function(){White.run()});
